---
layout: post
title: "非考试向计算机网络知识总结"
subtitle: ""
date: 2020-02-02
author: Aether
category: note
tags: 
finished: false
---

## 计算机网络模型

| OSI参考模型 | 五层参考模型 |
| :---------: | :----------: |
|   应用层    |    应用层    |
|   表示层    |    传输层    |
|   会话层    |    网络层    |
|   传输层    |  数据链路层  |
|   网络层    |    物理层    |
| 数据链路层  |              |
|   物理层    |              |

---

## 网络应用层

### 网络应用的体系结构 

- **客户机/服务器结构**(Client-Server, **C/S**)
- **点对点结构**(Peer-to-peer, **P2P**)
- **混合结构**(Hybrid)

### HTTP协议 —— HyperText Transfer Protocol

- **C/S结构** Client — Server
- HTTP版本：1.0、1.1
- 使用TCP传输服务
- **无状态**(stateless)：服务器不维护任何有关客户端过去所发请求的信息
- HTTP连接的两种类型

  - **非持久性连接**(Nonpersistent HTTP)
    - 每个TCP连接最多允许传输一个对象
    - HTTP 1.0版本使用非持久性连接
  - **持久性连接**(Persistent HTTP) 
    - 每个TCP连接允许传输多个对象
    - HTTP 1.1版本默认使用持久性连接
    - 带有流水机制的持久性连接

### Email应用

- **SMTP协议** (简单邮件传输协议 Simple Mail Transfer user agent Protocol)
- 邮件访问协议 - 从服务器获取邮件
  - **POP**: Post Office Protocol [RFC 1939]
  - **IMAP**: Internet Mail Access Protocol [RFC 1730]
  - **HTTP**:163, QQ Mail等。

### DNS应用

- **域名 --> IP地址**
- **主机别名**
- **负载均衡**
- **分布式**+**层次式**结构：
  - **根域名服务器**
  - **顶级域名服务器**
    - Network Solution维护com顶级域名服务器
    - Educause维护edu顶级域名服务器
  - **权威域名服务器**
  - **本地域名解析服务器**

- DNS查询：**迭代查询**/**递归查询**

---

## 传输层

传输层协议为**运行在不同主机上的进程**提供了一种**逻辑通信机制**

- 可靠、按序的交付服务 —— TCP

  - 拥塞控制、流量控制、连接建立

- 不可靠的交付服务 —— **UDP** (User Datagram Protocol)

  - 基于Internet IP协议：**多路复用/多路分用**、简单的**错误校验**
  - “Best effort”服务：UDP段可能**丢失**、**非按序**到达
  - **无连接**：UDP发送方和接收方之间*不需要握手*、每个UDP段的处理**独立**于其他段

- 用途：

  - 常用于**流媒体应用**：容忍丢失、速率敏感
  - 用于**DNS**、SNMP

### 滑动窗口协议

滑动窗口协议:GBN, SR

### 拥塞控制原理

- 拥塞：**分组丢失**(路由器缓存溢出)、**分组延迟过大**(在路由器缓存中排队)

- 拥塞控制vs流量控制：流量控制：端—端；拥塞控制：网络整体
- 拥塞控制的方法 
  - **端到端拥塞控制**：网络层不需要显式的提供支持，端系统通过观察loss，delay等网络行为判断是否发生拥塞来控制发送速率。TCP采取这种方法
  - **网络辅助的拥塞控制**：路由器向发送方显式地反馈网络拥塞信息指示发送方应该采取何种速率

### TCP拥塞控制

- 感知网络拥塞：Loss事件=timeout / 3个重复 ACK。发生loss事件后，发送方降低速率
  - 3个重复ACKs：CongWin减半后线性增长 —— 拥塞不太严重，还有传输segments的能力
  - Timeout事件： CongWin直接设为1个MSS后指数增长，达到threshold后, 再线性增长 —— 拥塞更严重

#### 调整发送速率策略：

- 加性增—乘性减: AIMD
  - 逐渐增加发送速率，谨慎探测可用带宽，直到发生loss
  - AI——Additive Increase: 每个RTT将CongWin增大一个MSS——拥塞避免
  - MD —— Decrease: 发生loss后将CongWin减半
- 慢启动: SS
  - 当连接开始时，CongWin指数性增长
  - Threshold = CongWin达到Loss时的1/2，当CongWin达到Threshold时变为线性增长

### TCP流量控制

- 接收方为TCP连接分配buffer，上层应用可能处理buffer中数据的速度较慢，流量控制使发送方不会传输的太多、太快以至于淹没接收方 (buffer溢出)
- **速度匹配**机制

### TCP三次握手四次挥手

- 三次握手

  - 客户端发送**SYN**报文段
    - 不携带数据
    - SYN标志位置1
    - 选择初始序列号
  - 服务器接受**SYN**，回复**SYNACK**报文段
    - 分配缓存
    - 确定初始序列号
  - 客户端接受**SYNACK**，回复**ACK**报文段，SYN标志位不为1，开始传输数据

- 关闭连接

  - 客户端关闭socket

  -  client向server发送TCP **FIN** 控制segment
  -  server **收到FIN**, **回复ACK**. **关闭连接**, **发送 FIN**.
  -  client **收到FIN, 回复ACK**.
     - 进入等待 —— 如果**收到FIN**，会**重新发送ACK**
  -  server**收到ACK. 连接关闭**

---

## 网络层

**网络层**:提供**主机之间**的逻辑通信机制

### 网络层核心功能

- 转发与路由
- 连接建立

### 网络层服务模型

- **无连接服务**(connection-less service): 
  - **数据报网络**(datagram network) 分组交换
- **连接服务**(connection service)
  - **虚电路网络**(virtual-circuit network) 分组交换

### 有类IP地址

|         |                           |        |                           |       |
| ------- | ------------------------- | ------ | ------------------------- | ----- |
| A类地址 | NetID(8位) + HostID(24位) | 0\**** | 0.0.0.0~127.255.255.255   | 50%   |
| B类地址 | NetID(16位) HostID(16位)  | 10***  | 128.0.0.0~191.255.255.255 | 25%   |
| C类地址 | NetID(24位) HostID(8位)   | 110**  | 192.0.0.0~223.255.255.255 | 12.5% |
| D类地址 | NetID(24位) HostID(8位)   | 1110*  | 224.0.0.0~239.255.255.255 | 6.25% |
| E类地址 | NetID(24位) HostID(8位)   | 1111*  | 240.0.0.0~255.255.255.255 | 6.25% |

#### 特殊IP地址

| NetID  | HostID                | IP分组源地址 | IP分组目的地址 | 用途                                                         |
| ------ | --------------------- | ------------ | -------------- | ------------------------------------------------------------ |
| 全0    | 全0                   | 可以         | 不可以         | 在本网范围内表示本机;在路由表中用于表示默认路由 (相当于表示整个Internet网络) |
| 全0    | 特定值                | 不可以       | 可以           | 表示本网内某个特定主机 0.0.0.0                               |
| 全1    | 全1                   | 不可以       | 可以           | 本网广播地址(路由器不转发) 255.255.255.255                   |
| 特定值 | 全0                   | 不可以       | 不可以         | 网络地址，表示一个网络                                       |
| 特定值 | 全1                   | 不可以       | 可以           | 直接广播地址，对特定网络上的所有主机进行广播                 |
| 127    | 非全0或非全1的 任何数 | 可以         | 可以           | 用于本地软件环回测试，称为环回地址                           |

#### 私有地址

| Class | NetIDs                   | Blocks |
| ----- | ------------------------ | ------ |
| A     | 10                       | 1      |
| B     | 172.16 to 172.31         | 16     |
| C     | 192.168.0 to 192.168.255 | 256    |

### CIDR与路由聚合

- 无类域间路由(CIDR: Classless InterDomain Routing) 
- 消除传统的 A 类、B 类和 C 类地址界限 
  - NetID+SubID→Network Prefix (Prefix)可以任意长度
- 融合子网地址与子网掩码，方便子网划分
  - 无类地址格式:a.b.c.d/x，其中x为前缀长度

### DHCP协议

- 主机获取IP地址方式：	
  - “硬编码” —— 静态配置
  - **动态主机配置协议** —— DHCP: Dynamic Host ConfigurationProtocol
    - 从服务器动态获取IP地址、子网掩码、默认网关地址、DNS服务器名称与IP地址
- DHCP特点
  - “即插即用”
  - 允许地址重用
  - 支持在用地址续租
  - 支持移动用户加入网络
- DHCP工作过程
  - 主机广播 “DHCP discover”(发现报文)
  - DHCP服务器利用 “DHCP offer” (提供报文) 进行响应
  - 主机请求IP地址: “DHCP request” (请求报文)
  - DHCP服务器分配IP地址: “DHCP ack” (确认报文)
- DHCP协议在**应用层**实现→请求报文封装到**UDP数据报**中→IP广播→链路层广播(e.g. 以太网广播)
- DHCP服务器构造ACK报文：包括分配给客户的IP地址、子网掩码 、默认网关、DNS 服务器地址

### NAT

- **网络地址转换**(NAT)

**本地网络**内通信的IP数据报的源与目的IP地址均在子网**10.0.0/24**内，所有离开本地网络去往 Internet的数据报的**源IP地址**需替换为**相同的NAT IP地址**: 138.76.29.7以及不同的端口号

- 优点

  - 只需/能从ISP申请一个IP地址（IPv4地址耗尽）

  - 本地网络设备全部使用私有地址，IP地址的变更无需通告外界网络

  - 变更ISP时，无需修改内部网络设备IP地址

  - 内部网络设备对外界网络不可见，即不可直接寻址(安全)


### ICMP

**互联网控制报文协议**(ICMP)支持主机或路由器差错(或异常)报告+网络探询

- ICMP 报文类型

  - **差错报告报文**(5种)
    - 目的不可达
    - 源抑制(Source Quench) 拥塞控制
    - 超时/超期(TTL)
    - 参数问题
    - 重定向 (Redirect)
  - **网络探询报文**(2组)
    - 回声(Echo)请求与应答报文(Reply)  —— `ping`
    - 时间戳请求与应答报文

- 几种不发送 ICMP差错报告报文的特殊情况:

  - 对ICMP差错报告报文不再发送 ICMP差错报告报文
  - 除第1个IP数据报分片外，对所有后续分片均不发送ICMP差错 报告报文
  - 对所有**多播IP数据报**均不发送 ICMP差错报告报文
  - 对具有**特殊地址**(如127.0.0.0 或 0.0.0.0)的IP数据报不发送ICMP差错报告报文

- ICMP报文的格式

  ICMP报文**封装到IP数据报**中传输

---

## 数据链路层

主机和路由器：结点

连接相邻结点的通信信道：链路  包括有线链路、无限链路、局域网

数据链路层负责通过一条链路从一个节点向另一个物理链路直接相连的相邻结点传送数据报。

- 组帧(framing)
  - 加首部尾部 将**数据报**组装为**帧**
  - 帧同步
- 链路接入(link access)：帧首部中的“MAC”地址，用于标识帧的源和目的
- 相邻结点间**可靠**交付
- 流量控制(flow control)
- 差错检测(error detection)：通知发送端重传或者直接丢弃帧
- 差错纠正(error correction) ：接收端直接纠正比特差错
- 全双工和半双工通信控制
  - 全双工:链路两端结点同时双向传输
  - 半双工:链路两端结点交替双向传输

### 多路访问控制(MAC)协议

两类“链路”：点对点链路、广播链路 (共享介质)

两个或者两个以上结点同时传输发生**冲突**(collision)

MAC协议采用**分布式算法**决定结点如何共享信道，即决策结点何时可以传输数据

MAC协议分类

- **信道划分**(channel partitioning)MAC协议
  - 多路复用技术
  - TDMA：“周期性”接入信道，每个站点在每个周期，占用固定长度的时隙
  - FDMA：信道频谱划分为若干频带(frequency bands)，每个站点分配一个固定的频带，无传输频带空闲
  - CDMA、WDMA等
- **随机访问**(random access)MAC协议 
  - 信道不划分，允许**冲突**
  - 采用冲突“**恢复**”机制
- **轮转**(“taking turns”)MAC协议 
  - 结点轮流使用信道

### ARP协议 

LAN中的每个IP结点维护**ARP表**，储存某些LAN结点的IP/MAC地址映射关系<IP,MAC,TTL>